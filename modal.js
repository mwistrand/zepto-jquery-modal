window.u$||(window.u$={}),function(a,b,c,d){"use strict";d||(d=b);var e,f,g=function(c){return b.Zepto?a.zepto.isZ(c):c instanceof a},h={clickOverlayToClose:!0,closeParams:'<a class="closeModal">close</a>',destroyOnClose:!1,eventNamespace:null,events:null,isLightbox:!0,modals:null,overlayParams:'<div class="overlay"></div>',triggerClass:"js-triggerModal"},i=function(b,c){this.options=a.extend({},this.options,c||null),this.attachModalEvents(),(b||this.options.modals||this.options.url)&&(null===b?this.load(null,0):(this.triggers=b,this.attach(b)))},j=function(b,c,d){var e=a.isArray(b)?a.apply(a,b):a(b),f=d?"prependTo":"appendTo";return c&&e[f](c),e},k=function(){function b(b,d,e){var f=b.replace(c,function(a,b){var c=d[b];return c||""});f.length&&a(f).appendTo(e)}var c=/\{\{([A-Za-z0-9\-_]+)\}\}/gi;return function(c,d,e){e.html(""),a.isArray(d)?d.forEach(function(a){b(c,a,e)}):b(c,d,e)}}(),l=function(){var b={clickOverlay:function(){e.data("clickToClose")&&this.hide()},close:function(a){a.preventDefault(),this.hide()},show:function(b){var c=a(b.target),d=this.options.triggerClass,e=!0;a.isFunction(d)?e=d(c):c.hasClass(d)||(c=c.parent("."+d).eq(0),e=!!c.length),e&&(b.preventDefault(),this.load(c))}};return function(c,d,e){var f=(this.options.eventNamespace||"")+"Modal:"+c+"Event",g=a.proxy(b[c],this);d.on("click."+f,e,g)}}(),m={options:h,attach:function(a){l.call(this,"show",a,"."+this.options.triggerClass)},attachModalEvents:function(){var b=a(c.body);l.call(this,"close",b,".js-closeModal"),l.call(this,"clickOverlay",b,".js-overlay")},detach:function(b){var d,e=(this.options.eventNamespace||"")+"Modal:";b?b.removeClass(this.options.triggerClass):(this.hide(),b=this.triggers,d=this.modals,this.triggers=null,this.modals=null,a(c.body).off("click."+e+"closeEvent"),a(c.body).off("click."+e+"clickOverlayEvent")),b&&b.off("click."+e+"showEvent"),this.emit("detach",d,b)},add:function(a,b){this.triggers&&b===!1?a.addClass(this.options.triggerClass):(this.triggers=this.triggers?this.triggers.add(a):a,this.attach(a))},load:function(b,c){var d,e=b?b.data("modalindex"):c;"number"!=typeof e?(e=this.modals&&this.modals.length||0,d=a("#"+b.data("modalid")),this.modals=e?this.modals.add(d):d,b.data("modalindex",e)):(this.modals||(this.modals=a(this.options.modals)),d=this.modals.eq(e)),this.show(d,b)},show:function(a,b){this.emit("beforeShow",a,b,e),f=a,this.options.closeParams&&!a.find(".js-closeModal").length&&j(this.options.closeParams,a,!0).addClass("js-closeModal"),a.removeClass("is-invisible").center(),this.showOverlay(),this.emit("show",a,b,e)},showOverlay:function(){this.options.isLightbox&&(e||(e=j(this.options.overlayParams,c.body),e.addClass("js-overlay")),e.removeClass("is-invisible").data("clickToClose",!!this.options.clickOverlayToClose))},hide:function(){f&&(this.emit("beforeHide",f,e),this.options.destroyOnClose?(this.modals=this.modals.not(f.get(0)),f.empty().remove()):f.addClass("is-invisible"),e&&e.addClass("is-invisible"),this.emit("hide",f,e)),f=null},emit:function(b){var c=this.options.events,d=c?0:1,e=c?this.trigger:this.options["on"+b.charAt(0).toUpperCase()+b.slice(1)];a.isFunction(e)&&e.apply(this,[].slice.call(arguments,d))}},n=a.extend({},m,{options:a.extend({},h,{cache:!0,modals:["<div />",{"class":"modal js-modal"}]}),setCache:function(a,b){this.options.cache&&(this._cache||(this._cache={}),this._cache[a]=b)},getCache:function(a){return this._cache&&this._cache[a]||null},load:function(b){var c,d=this.options.query;a.isFunction(d)&&(d=d(b)),c=this.getCache(d),c?this.show(c,b):a.ajax({url:this.options.url,data:d,beforeSend:function(a,c){this.emit("beforeSend",b,a,c)}.bind(this),success:function(a,c,e){this.setCache(d,e.responseText),this.show(e.responseText,b)}.bind(this),error:function(a,c,d){this.emit("ajaxError",b,a,c,d)}.bind(this)})},show:function(b,d){var e,g="render"+("html"===this.options.responseType?"HTML":"JSON");this.modals||(this.modals=j(this.options.modals,a(c.body))),f=e=this.modals.eq(0).center(),this.emit("beforeShow",e,d,b),this[g](e,b),this.options.closeParams&&!e.find(".js-closeModal").length&&j(this.options.closeParams,e,!0).addClass("js-closeModal"),this.emit("show",e,d,b)},renderJSON:function(b,c){var d=a.parseJSON(c),e=this.options.template;a.isFunction(e)?e(b,d):k(e,d,b)},renderHTML:function(a,b){a.html(b)}});d.modal=function(b,c){var d,e=m;return g(b)||(c=b,b=null),c&&c.url&&(e=n),d=Object.create(e),c&&c.events&&a.extend(d,c.events),i.call(d,b,c),d}}(window.Zepto||window.jQuery,window,document,u$);